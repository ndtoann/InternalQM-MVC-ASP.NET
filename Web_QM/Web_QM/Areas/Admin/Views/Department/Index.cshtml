@using Web_QM.Models
@model IEnumerable<Department>;
@{
    ViewData["Title"] = "Bộ phận";
}

<div class="content-wrapper">
    <div class="row">
        <div class="col-lg-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Danh sách bộ phận</h4>
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            @TempData["SuccessMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            @TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }
                    <a class="btn btn-success" href="~/admin/department/add" asp-policy="AddDepartment">Thêm mới</a>
                    <div class="table-responsive">
                        <table class="table table-hover table-bordered">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Bộ phận</th>
                                    <th>Ghi chú</th>
                                </tr>
                            </thead>
                            <tbody class="department-table-body">
                                @{
                                    var count = 1;
                                }
                                @foreach (var item in Model)
                                {
                                    <tr class="context-menu-row" data-id="@item.Id" data-department-name="@item.DepartmentName">
                                        <td>@(count++)</td>
                                        <td>@item.DepartmentName</td>
                                        <td>@item.Note</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="contextMenu" class="dropdown-menu" style="position: absolute; display: none;">
    <a class="dropdown-item" href="#" id="editLink">Sửa</a>
    <a class="dropdown-item" href="#" id="deleteLink">Xóa</a>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tableBodies = document.querySelectorAll('.department-table-body');
            const contextMenu = document.getElementById('contextMenu');
            let departmentId = null;
            let departmentName = null;

            tableBodies.forEach(tableBody => {
                tableBody.addEventListener('contextmenu', function (event) {
                    const row = event.target.closest('tr');
                    if (!row) return;

                    event.preventDefault();

                    departmentId = row.getAttribute('data-id');
                    departmentName = row.getAttribute('data-department-name');

                    contextMenu.style.display = 'block';
                    contextMenu.style.left = event.pageX + 'px';
                    contextMenu.style.top = event.pageY + 'px';
                });
            });

            document.addEventListener('click', function (e) {
                if (!contextMenu.contains(e.target)) {
                    contextMenu.style.display = 'none';
                }
            });

            document.getElementById('editLink').addEventListener('click', function (event) {
                if (departmentId) {
                    window.location.href = `/admin/department/edit?id=${departmentId}`;
                }
            });

            document.getElementById('deleteLink').addEventListener('click', function (event) {
                if (departmentId && confirm(`Bạn có chắc chắn muốn xóa bộ phận ${departmentName}?`)) {
                    window.location.href = `/admin/department/delete?id=${departmentId}`;
                }
            });
        });
    </script>
}